import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.net.Socket;
import java.text.SimpleDateFormat;
import java.util.Calendar;

/**
 * Created by hakon on 07.02.2017.
 */

public class ServerThread implements Runnable {
    private static Socket clientSocket;
    private static String nickCage =
            "                                                                                      \n" +
                    "                                                                                      \n" +
                    "                                               `                                      \n" +
                    "                                           ##+';''+                                   \n" +
                    "                               ####++''++####++++'+'`                                 \n" +
                    "                            .#++#++'+'+++###+#++##++''                                \n" +
                    "                           ###+''+++'+++####+###########                              \n" +
                    "                          +#####+++#+++#############++'+##;                           \n" +
                    "                         +##+#+++++#####+#++#########++++###                          \n" +
                    "                        +###+++++++####++++++#########+'++@#+                         \n" +
                    "                        ###+##++######+++++++##########+'''#+;                        \n" +
                    "                       ##########+#++#+++++'++#####@###+++++++,                       \n" +
                    "                      ##+########+#+#++++#++++#++######++';#+#+#:                     \n" +
                    "                     @######@#####+++++++#+++++#+#######+'++++++'+                    \n" +
                    "                    +#######@##++''++++++#++++++++#+###@#++++++###,                   \n" +
                    "                   `###@##@@@#+;;;;;;';''''''''+;''''+####+#++#++##                   \n" +
                    "                   ####@@@@#+';:;;;::::::::::;;;;;;;;''+##+#''##++##                  \n" +
                    "                 :#######@##;::::::::::::::::::::::;;;''#####'+###+#                  \n" +
                    "                 #+#######+;:::::::::::,,,,,,:::::::;;;;'+#+##'+###++                 \n" +
                    "                #########+::::::::::::,,,,,,,::::::;::;;;;+####+#####                 \n" +
                    "                ##+####+'::::::::,:,,,,,,,,,,:::::::;;;;;;'##########`                \n" +
                    "               ####+##++;::::,:::,,,,,,,,,,,:::::::::;;;;;;+#@##@####+                \n" +
                    "               #######+;:::,,,:,,,,,,,,,,,,,,:::::,:::;;;;;'+#@#######                \n" +
                    "              ######+#;:::,,,,,,,,,,,,,,,,,,,,::,:::::::;;;''##@@#####`               \n" +
                    "              #######+;::,,,,,,,,,,,,,,,,,,,,,,,,:::::::::;;'+##@@#####               \n" +
                    "              ###+##++:::,,,,,,,.,,,,,....,,,,,,,::::::::;;;'++##@@@###               \n" +
                    "              #@###++;:::,,,,,,...,,,,,,..,,,,,,,,::::::;;:;''+#@###@##               \n" +
                    "              #@####+:::,,,,,,,...,,,,,.,,,.,,,,,,::::::::::;'+##@##@@#               \n" +
                    "              ###@#+'::::,,,,,,,,,,,,,....,,,,,,,,:::::::::;;;'##@@#@@#               \n" +
                    "              ##@##+'::::,,,,,,,,,,,,.,,,,,,,,,,,,:::::::::;;;'###@#@@@               \n" +
                    "              #####+'::::,,,,,,,..,,,,,,,,,,,,,,,,:::::::::;;;'+#@@@##@               \n" +
                    "              @@@###'::::,,,,,,,,,..,,,,,,,,,,,,,,::::::::;;;;;+##@@#@@`              \n" +
                    "               @@###':::,,,,,,,,,,....,,,,,,,,,,,,,:::::::;;;;;'##@@@@@#              \n" +
                    "               @###+;:::,:,,,,,,,,.....,,,,,,,,,,,::::::::;;;;;'+##@@@@#              \n" +
                    "               @@@#+':::::,,,,,.,,,,,..,,,,,.,,,,,,,,,::::;;;;''#@#@@@@@              \n" +
                    "               @@@#+':::::,,,,,,,,,,,,..,.,,,,,,,,,,,,::::;;;;;'+@#@@@@@              \n" +
                    "               @@##+;:::::,,,;::;;;::::,,,,,,,;;;;;;;:;;;:;;;;''+#@@@@@#              \n" +
                    "               @@##+;::::::;'';''+++'';;,,,,,:;'++#++'''';;;';''+#@@@@##              \n" +
                    "               ####+::::::;'';'+++++++;;,,,,,:;'++++++++''';';''+#@@@@##              \n" +
                    "               #@#@+;::::;;::,,,,:;;::;;,,.,,;;:::::::::;'''';''+#@@@@@.              \n" +
                    "               '###+::,:::::,;::::;;:::,,,,,;;::;;;:::;;;;;';'''+##@@@#               \n" +
                    "                ##++::,:,,,:;;+#+++;:::,,,.,;:::;;+++';'';;;;;;'+##@@##               \n" +
                    "                @#++::,,,,:'+;,;+;,:;,,,,,,:;:,;',;+++++';;;;;;'+##@@#                \n" +
                    "                ###'::,,,,:';:,;;:::::,,,,,:;:,:::;:;;;++;:;;;;'+#@@#,                \n" +
                    "                ;;#+::,,,,:,:::;;:::,,,,,,,:;;,::::;:;''';:;:;;'+##+#                 \n" +
                    "                :;#+::,,,,,,,,,,:::,,,,,,,,:;;,,::::::;::;:::;;'+#+;'                 \n" +
                    "               ,..;+::,,,,,,,,,,,,,..,,,,,,:;::,,,,,:::::::::;;''''+'                 \n" +
                    "               .,.,;::,,,,,..........,,,,,,:;::,,,,,,,,,:::::;;'';;'                  \n" +
                    "               .,.,:::,,,,...........,,,,,,:;::,,,,,,,,,::::;;;''':;:                 \n" +
                    "               ...,::::,....,,......,,,:,.,:;;::,.,,,,,,,,,:;;'';;:::                 \n" +
                    "               ,..,,;::,............,,,,,,,:;;::,,,,,,,,,,,::;'';;:::                 \n" +
                    "               ,.,,::::,,.........,,,,,,,,,::;;::,,,,,,,,,::;''';':::                 \n" +
                    "               ,,,.,;;:,,,.........,,,,,,,,::;::,,,,,,.,,,::;''''::,:                 \n" +
                    "               ,,,,,::::,,.........:,,,,,,,::::;,,,,.,,,,,::;'''':;,:                 \n" +
                    "               ,::,,:;;:,,........,,,.,,..,::::;,,,,.,,,,::;;''';::,:                 \n" +
                    "               .,,,::;:::,,.......::,,,:,,,:;::;:,,,,,,,,::;'''';;;::                 \n" +
                    "               ,,,,,:;:::,,.....,,:::'+::::;++'':,,,,,,,::;;'''';;;::                 \n" +
                    "                ,,,,,;:::,,....,,:,,;;;;;;;';;;':,,,.,,,::;;'''';:;::                 \n" +
                    "                ,,,,,;::,:,....,,:,,,,:,,;'::;::,,,,,,,,::;;'''';;:::                 \n" +
                    "                `,,,,;::,,,....,,,...,,,,,,,::::,,,,,,,:::;'''+;;:::`                 \n" +
                    "                 :,,,;:::,,,..,,,,,,,,,,,,,,,::::,,,,,:::;;;''+:;:::                  \n" +
                    "                  :,,;:::,,,,,,,,,.,,,,,,,,,,,:::,,:,,:::;;'''+:;::                   \n" +
                    "                   :,,:::,,,,,,,.....,..,,,,,,::::::,::::;;;''+;;:`                   \n" +
                    "                     .;::,,,,,,,..,,,,,..,.,,,::::,:::::;;;;''                        \n" +
                    "                      :::,,,,,,,,,,,,,,,::::::::::,::,::;;;;'+                        \n" +
                    "                      :::,,,,,,,,:;::::;:::;''''';:,:,:;;;;;'                         \n" +
                    "                       ::,,,,,,,:;:#;:......,:'';:;::,:;;:;'+                         \n" +
                    "                       ::,,,,,,,:,,:,,::.,,,::;;:::::,;;':;'                          \n" +
                    "                        ;:,,,,,,,,,,,,,,,,,,::::::,,,:;';;;+                          \n" +
                    "                        ;::,,,,,..,,,,,,.,,,,::;:,,,,:;';;'                           \n" +
                    "                         ;:::,,,,,,,:,,,,,:::;;::,::::;';;'                           \n" +
                    "                          ::::,,,,,,,::::::;::,,,::::;'';'+                           \n" +
                    "                          ;:::,,,,,,,,,,,:::,,,:::::;;';''                            \n" +
                    "                           ::::,,,,,,,,,,::::,:::::;;''''                             \n" +
                    "                            :::,,,,,,,,..,,,,,,,,::;;'''+                             \n" +
                    "                             :;:,,,,.,,.,,,,,,,,,:;;'+'+                              \n" +
                    "                             .;;:,,,.,...,.,,,::::;''+.                               \n" +
                    "                               ;::,,,,.....,,,::::;++                                 \n" +
                    "                                ;:,,,,,...,,,,:::;'+                                  \n" +
                    "                                 ::,,,,,,,,,,:::;'                                    \n" +
                    "                                  ;:::::::::::;;'                                     \n" +
                    "                                    ;;:;::;:;;',                                      \n" +
                    "                                       `'';;'                                         \n" +
                    "                                                                                      ";
    private static String penis = "……………………„„-~^^~„-„„_\n"+
            "………………„-^*'' : : „'' : : : : *-„\n"+
            "…………..„-* : : :„„--/ : : : : : : : '\\\n"+
            "…………./ : : „-* . .| : : : : : : : : '|\n"+
            "……….../ : „-* . . . | : : : : : : : : |\n"+
            "………...\\„-* . . . . .| : : : : : : : :'|\n"+
            "……….../ . . . . . . '| : : : : : : : :|\n"+
            "……..../ . . . . . . . .'\\ : : : : : : : |\n"+
            "……../ . . . . . . . . . .\\ : : : : : : :|\n"+
            "……./ . . . . . . . . . . . '\\ : : : : : /\n"+
            "….../ . . . . . . . . . . . . . *-„„„„-*'\n"+
            "….'/ . . . . . . . . . . . . . . '|\n"+
            "…/ . . . . . . . ./ . . . . . . .| \n"+
            "../ . . . . . . . .'/ . . . . . . .'|\n"+
            "./ . . . . . . . . / . . . . . . .'|\n"+
            "'/ . . . . . . . . . . . . . . . .'|\n"+
            "'| . . . . . \\ . . . . . . . . . .|\n"+
            "'| . . . . . . \\„_^- „ . . . . .'|\n"+
            "'| . . . . . . . . .'\\ .\\ ./ '/ . |\n"+
            "| .\\ . . . . . . . . . \\ .'' / . '|\n"+
            "| . . . . . . . . . . / .'/ . . .|\n"+
            "| . . . . . . .| . . / ./ ./ . .|\n";
    private static String header =
            "oooooo     oooo oooooooooooo ooooo        oooo    oooo   .oooooo.   ooo        ooooo ooo        ooooo oooooooooooo ooooo      ooo    ooooooooooooo ooooo ooooo       \n" +
            " `888.     .8'  `888'     `8 `888'        `888   .8P'   d8P'  `Y8b  `88.       .888' `88.       .888' `888'     `8 `888b.     `8'    8'   888   `8 `888' `888'       \n" +
            "  `888.   .8'    888          888          888  d8'    888      888  888b     d'888   888b     d'888   888          8 `88b.    8          888       888   888        \n" +
            "   `888. .8'     888oooo8     888          88888[      888      888  8 Y88. .P  888   8 Y88. .P  888   888oooo8     8   `88b.  8          888       888   888        \n" +
            "    `888.8'      888    \"     888          888`88b.    888      888  8  `888'   888   8  `888'   888   888    \"     8     `88b.8          888       888   888        \n" +
            "     `888'       888       o  888       o  888  `88b.  `88b    d88'  8    Y     888   8    Y     888   888       o  8       `888          888       888   888       o\n" +
            "      `8'       o888ooooood8 o888ooooood8 o888o  o888o  `Y8bood8P'  o8o        o888o o8o        o888o o888ooooood8 o8o        `8         o888o     o888o o888ooooood8\n" +
            "                                                                                                                                                                     \n" +
            "                                                                                                                                                                     \n" +
            "                                                                                                                                                                     \n" +
            "ooooo   ooooo       .o.       oooo    oooo   .oooooo.   ooooo      ooo     .oooooo..o ooooo ooooo      ooo                                                           \n" +
            "`888'   `888'      .888.      `888   .8P'   d8P'  `Y8b  `888b.     `8'    d8P'    `Y8 `888' `888b.     `8'                                                           \n" +
            " 888     888      .8\"888.      888  d8'    888      888  8 `88b.    8     Y88bo.       888   8 `88b.    8                                                            \n" +
            " 888ooooo888     .8' `888.     88888[      888      888  8   `88b.  8      `\"Y8888o.   888   8   `88b.  8                                                            \n" +
            " 888     888    .88ooo8888.    888`88b.    888      888  8     `88b.8          `\"Y88b  888   8     `88b.8                                                            \n" +
            " 888     888   .8'     `888.   888  `88b.  `88b    d88'  8       `888     oo     .d8P  888   8       `888                                                            \n" +
            "o888o   o888o o88o     o8888o o888o  o888o  `Y8bood8P'  o8o        `8     8\"\"88888P'  o888o o8o        `8                                                            \n" +
            "                                                                                                                                                                     \n" +
            "                                                                                                                                                                     \n" +
            "                                                                                                                                                                     \n" +
            "ooooooooooooo ooooo oooooooooo.    .oooooo..o  .oooooo..o oooooooooooo ooooooooo.   oooooo     oooo oooooooooooo ooooooooo.                                          \n" +
            "8'   888   `8 `888' `888'   `Y8b  d8P'    `Y8 d8P'    `Y8 `888'     `8 `888   `Y88.  `888.     .8'  `888'     `8 `888   `Y88.                                        \n" +
            "     888       888   888      888 Y88bo.      Y88bo.       888          888   .d88'   `888.   .8'    888          888   .d88'                                        \n" +
            "     888       888   888      888  `\"Y8888o.   `\"Y8888o.   888oooo8     888ooo88P'     `888. .8'     888oooo8     888ooo88P'                                         \n" +
            "     888       888   888      888      `\"Y88b      `\"Y88b  888    \"     888`88b.        `888.8'      888    \"     888`88b.                                           \n" +
            "     888       888   888     d88' oo     .d8P oo     .d8P  888       o  888  `88b.       `888'       888       o  888  `88b.                                         \n" +
            "    o888o     o888o o888bood8P'   8\"\"88888P'  8\"\"88888P'  o888ooooood8 o888o  o888o       `8'       o888ooooood8 o888o  o888o  ";

    public ServerThread(Socket clientSocket) {
        this.clientSocket = clientSocket;
    }

    public void run() {
        try {
            Thread.currentThread().sleep(1000);

            System.out.println("Connection received from: " + clientSocket.hashCode());
            BufferedReader inFromClient = null;
            DataOutputStream outToClient = null;
            inFromClient = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));
            outToClient = new DataOutputStream(clientSocket.getOutputStream());

            outToClient.writeBytes(header + "\nEND\n");

            String command = null;

            do {
                command = inFromClient.readLine().toUpperCase();

                String response = null;

                if (command.equals("FULL")) {
                    response = new SimpleDateFormat("MMMM yyyy HH:mm:ss").format(Calendar.getInstance().getTime());
                } else if (command.equals("DATE")) {
                    response = new SimpleDateFormat("MMMM yyyy").format(Calendar.getInstance().getTime());
                } else if (command.equals("TIME")) {
                    response = new SimpleDateFormat("HH:mm:ss").format(Calendar.getInstance().getTime());
                } else if (command.equals("CLOSE")) {
                    response = "CLOSE";
                } else if (command.equals("PICTURE")) {
                    response = nickCage;
                } else {
                    response = "COMMAND NOT RECOGNIZED";
                }
                System.out.println("Command: " + command + " |Client: " + clientSocket.getRemoteSocketAddress() + " |response: " + response);

                outToClient.writeBytes(response + "\nEND\n");


            } while (!command.equals("CLOSE"));
            Thread.currentThread().sleep(1000);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}